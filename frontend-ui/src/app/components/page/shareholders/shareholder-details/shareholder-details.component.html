<main class="main-content" [class.collapsed]="isSidebarCollapsed">
  <div class="container-fluid mt-4">
    <!-- Header Card -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center py-3">
        <div>
          <h4 class="mb-0">
            <i class="fas fa-user-tie me-2"></i>
            Shareholder Dashboard
          </h4>
          <small class="opacity-75">Comprehensive financial overview and performance metrics</small>
        </div>
        <div>
          <button class="btn btn-light text-primary me-2" (click)="editShareholder()">
            <i class="fas fa-edit me-1"></i> Edit
          </button>
          <button class="btn btn-outline-light" (click)="goBack()">
            <i class="fas fa-arrow-left me-1"></i> Back
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3 text-muted">Loading shareholder details...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="alert alert-danger alert-dismissible fade show shadow-sm">
      <i class="fas fa-exclamation-circle me-2"></i>{{ error }}
      <button type="button" class="btn-close" (click)="error = null"></button>
    </div>

    <!-- Main Content -->
    <div *ngIf="!loading && shareholderDetails">
      
      <!-- Key Metrics Cards -->
      <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
          <div class="card metric-card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted mb-1 small">Total Investment</p>
                  <h3 class="mb-0 fw-bold text-primary">{{ formatCurrency(shareholderDetails.investment) }}</h3>
                </div>
                <div class="icon-box bg-primary-light">
                  <i class="fas fa-hand-holding-usd text-primary"></i>
                </div>
              </div>
              <div class="mt-3">
                <small class="text-muted">
                  <i class="fas fa-calendar me-1"></i>Since {{ formatDate(shareholderDetails.activeSince) }}
                </small>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
          <div class="card metric-card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted mb-1 small">Total Earnings</p>
                  <h3 class="mb-0 fw-bold text-success">{{ formatCurrency(shareholderDetails.totalEarnings) }}</h3>
                </div>
                <div class="icon-box bg-success-light">
                  <i class="fas fa-chart-line text-success"></i>
                </div>
              </div>
              <div class="mt-3">
                <small class="text-success">
                  <i class="fas fa-arrow-up me-1"></i>ROI: {{ formatROI() }}
                </small>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
          <div class="card metric-card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted mb-1 small">Current Balance</p>
                  <h3 class="mb-0 fw-bold text-info">{{ formatCurrency(shareholderDetails.currentBalance) }}</h3>
                </div>
                <div class="icon-box bg-info-light">
                  <i class="fas fa-wallet text-info"></i>
                </div>
              </div>
              <div class="mt-3">
                <small class="text-muted">
                  <i class="fas fa-coins me-1"></i>Available funds
                </small>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
          <div class="card metric-card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted mb-1 small">Total Value</p>
                  <h3 class="mb-0 fw-bold text-warning">{{ formatCurrency(shareholderDetails.totalValue) }}</h3>
                </div>
                <div class="icon-box bg-warning-light">
                  <i class="fas fa-trophy text-warning"></i>
                </div>
              </div>
              <div class="mt-3">
                <small class="text-muted">
                  <i class="fas fa-share-alt me-1"></i>{{ shareholderDetails.totalShares }} shares
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Progress Bar -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">Earnings Progress</h6>
                <span class="badge bg-success">{{ formatROI() }}</span>
              </div>
              <div class="progress" style="height: 25px;">
                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                     role="progressbar" 
                     [style.width.%]="getProgressPercentage()"
                     [attr.aria-valuenow]="getProgressPercentage()"
                     aria-valuemin="0" 
                     aria-valuemax="100">
                  {{ formatCurrency(shareholderDetails.totalEarnings) }}
                </div>
              </div>
              <div class="d-flex justify-content-between mt-2">
                <small class="text-muted">Investment: {{ formatCurrency(shareholderDetails.investment) }}</small>
                <small class="text-muted">Monthly Avg: {{ getMonthlyAverage() }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="row mb-4">
        <div class="col-xl-4 mb-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div style="height: 300px;">
                <canvas id="investmentChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-4 mb-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div style="height: 300px;">
                <canvas id="earningsChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-4 mb-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div style="height: 300px;">
                <canvas id="monthlyChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Detailed Information -->
      <div class="row">
        <!-- Personal Information -->
        <div class="col-lg-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0">
                <i class="fas fa-user-circle me-2 text-primary"></i>Personal Information
              </h5>
            </div>
            <div class="card-body">
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-user text-muted me-2"></i>Full Name
                </div>
                <div class="info-value">{{ shareholderDetails.shareholder?.name }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-phone text-muted me-2"></i>Phone Number
                </div>
                <div class="info-value">{{ shareholderDetails.shareholder?.phone || 'N/A' }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-id-card text-muted me-2"></i>NID Card
                </div>
                <div class="info-value">{{ shareholderDetails.shareholder?.nidCard || 'N/A' }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-user-friends text-muted me-2"></i>Nominee
                </div>
                <div class="info-value">{{ shareholderDetails.shareholder?.nominee || 'N/A' }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-briefcase text-muted me-2"></i>Role
                </div>
                <div class="info-value">{{ shareholderDetails.shareholder?.role || 'N/A' }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-circle text-muted me-2"></i>Status
                </div>
                <div class="info-value">
                  <span [class]="getStatusClass(shareholderDetails.shareholder?.status)">
                    {{ shareholderDetails.shareholder?.status }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Address & Timeline -->
        <div class="col-lg-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0">
                <i class="fas fa-map-marker-alt me-2 text-primary"></i>Address & Timeline
              </h5>
            </div>
            <div class="card-body">
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-city text-muted me-2"></i>District (Zila)
                </div>
                <div class="info-value">{{ shareholderDetails.shareholder?.zila || 'N/A' }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-home text-muted me-2"></i>House Address
                </div>
                <div class="info-value">{{ shareholderDetails.shareholder?.house || 'N/A' }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-calendar-check text-muted me-2"></i>Join Date
                </div>
                <div class="info-value">{{ formatDate(shareholderDetails.shareholder?.joinDate) }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-clock text-muted me-2"></i>Active Since
                </div>
                <div class="info-value">{{ formatDate(shareholderDetails.activeSince) }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-hourglass-half text-muted me-2"></i>Months Active
                </div>
                <div class="info-value">
                  <span class="badge bg-info">{{ getMonthsActive() }} months</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Financial Summary Table -->
      <div class="row">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0">
                <i class="fas fa-table me-2 text-primary"></i>Financial Summary
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Metric</th>
                      <th class="text-end">Amount</th>
                      <th class="text-end">Percentage</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><i class="fas fa-hand-holding-usd text-primary me-2"></i>Initial Investment</td>
                      <td class="text-end fw-bold">{{ formatCurrency(shareholderDetails.investment) }}</td>
                      <td class="text-end">100%</td>
                    </tr>
                    <tr>
                      <td><i class="fas fa-chart-line text-success me-2"></i>Total Earnings</td>
                      <td class="text-end fw-bold text-success">{{ formatCurrency(shareholderDetails.totalEarnings) }}</td>
                      <td class="text-end">{{ formatROI() }}</td>
                    </tr>
                    <tr>
                      <td><i class="fas fa-wallet text-info me-2"></i>Current Balance</td>
                      <td class="text-end fw-bold text-info">{{ formatCurrency(shareholderDetails.currentBalance) }}</td>
                      <td class="text-end">-</td>
                    </tr>
                    <tr class="table-active">
                      <td><i class="fas fa-trophy text-warning me-2"></i><strong>Total Portfolio Value</strong></td>
                      <td class="text-end fw-bold text-warning">{{ formatCurrency(shareholderDetails.totalValue) }}</td>
                      <td class="text-end"><span class="badge bg-warning text-dark">Portfolio</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</main>